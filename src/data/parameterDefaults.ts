import {
  AllParameters,
  ProjectInputs,
  CostDistribution,
} from '../types'
import {
  getConstructionCost,
  getSalesPrice,
  getLandPrice,
  COST_MULTIPLIERS,
} from './referenceData'

interface TimelineDefaults {
  constructionMonths: number
  costDistribution: CostDistribution
  monthlyInflationRate: number
  monthlyAppreciationRate: number
  monthsToSell: number
}

/**
 * Generate all calculation parameters with transparency metadata
 */
export function getDefaultParameters(
  inputs: ProjectInputs,
  timelineDefaults: TimelineDefaults
): AllParameters {
  const landPricePerSqm = getLandPrice(inputs.location)
  const constructionCostPerSqm = getConstructionCost(inputs.qualityLevel)
  const salesPricePerSqm = getSalesPrice(inputs.projectType, inputs.qualityLevel, inputs.location)

  return {
    location: {
      groupKey: 'location',
      groupLabel: 'Location & Land',
      groupLabelTR: 'Konum ve Arsa',
      parameters: [
        {
          key: 'location',
          label: 'Location',
          labelTR: 'Konum',
          value: inputs.location,
          unit: '',
          source: 'user_input',
          editable: false,
          description: 'Project location',
          descriptionTR: 'Proje konumu',
        },
        {
          key: 'landPricePerSqm',
          label: 'Land Price per sqm',
          labelTR: 'Arsa m² Fiyatı',
          value: landPricePerSqm,
          unit: 'TL/m²',
          source: 'district_data',
          editable: true,
          description: 'Average land price in this district',
          descriptionTR: 'Bu bölgedeki ortalama arsa fiyatı',
          min: 1000,
          max: 50000,
          step: 500,
        },
        {
          key: 'landSize',
          label: 'Land Size',
          labelTR: 'Arsa Büyüklüğü',
          value: inputs.landSize,
          unit: 'm²',
          source: 'user_input',
          editable: false,
          description: 'Total land area',
          descriptionTR: 'Toplam arsa alanı',
        },
        {
          key: 'emsal',
          label: 'EMSAL (Floor Area Ratio)',
          labelTR: 'EMSAL (İmar Katsayısı)',
          value: inputs.emsal,
          unit: '',
          source: 'user_input',
          editable: false,
          description: 'Floor area ratio from zoning',
          descriptionTR: 'İmar durumundan kat alanı katsayısı',
        },
        {
          key: 'maxBuildableArea',
          label: 'Max Buildable Area',
          labelTR: 'Maksimum İnşa Edilebilir Alan',
          value: inputs.landSize * inputs.emsal,
          unit: 'm²',
          source: 'calculated',
          editable: false,
          description: 'Maximum construction area allowed',
          descriptionTR: 'İzin verilen maksimum inşaat alanı',
        },
        {
          key: 'totalSqm',
          label: 'Planned Construction Area',
          labelTR: 'Planlanan İnşaat Alanı',
          value: inputs.totalSqm,
          unit: 'm²',
          source: 'user_input',
          editable: false,
          description: 'Total construction area planned',
          descriptionTR: 'Planlanan toplam inşaat alanı',
        },
      ],
    },

    constructionCosts: {
      groupKey: 'constructionCosts',
      groupLabel: 'Construction Costs',
      groupLabelTR: 'İnşaat Maliyetleri',
      parameters: [
        {
          key: 'projectType',
          label: 'Project Type',
          labelTR: 'Proje Tipi',
          value: inputs.projectType,
          unit: '',
          source: 'user_input',
          editable: false,
          description: 'Type of construction project',
          descriptionTR: 'İnşaat proje tipi',
        },
        {
          key: 'qualityLevel',
          label: 'Quality Level',
          labelTR: 'Kalite Seviyesi',
          value: inputs.qualityLevel,
          unit: '',
          source: 'user_input',
          editable: false,
          description: 'Construction quality standard',
          descriptionTR: 'İnşaat kalite standardı',
        },
        {
          key: 'baseCostPerSqm',
          label: 'Base Construction Cost',
          labelTR: 'Temel İnşaat Maliyeti',
          value: constructionCostPerSqm,
          unit: 'TL/m²',
          source: 'default',
          editable: true,
          description: 'Base cost per sqm for selected quality level',
          descriptionTR: 'Seçilen kalite seviyesi için m² temel maliyeti',
          min: 5000,
          max: 30000,
          step: 500,
        },
        {
          key: 'permitsAndFeesPercent',
          label: 'Permits & Fees',
          labelTR: 'İzin ve Harçlar',
          value: COST_MULTIPLIERS.permitsAndFees * 100,
          unit: '%',
          source: 'default',
          editable: true,
          description: 'Building permits and municipal fees as % of construction cost',
          descriptionTR: 'Yapı izinleri ve belediye harçları (inşaat maliyetinin %)',
          min: 1,
          max: 15,
          step: 0.5,
        },
        {
          key: 'designFeePercent',
          label: 'Design & Engineering Fees',
          labelTR: 'Proje ve Mühendislik Ücretleri',
          value: COST_MULTIPLIERS.design * 100,
          unit: '%',
          source: 'default',
          editable: true,
          description: 'Architect and engineering fees as % of construction cost',
          descriptionTR: 'Mimar ve mühendislik ücretleri (inşaat maliyetinin %)',
          min: 2,
          max: 10,
          step: 0.5,
        },
        {
          key: 'contingencyPercent',
          label: 'Contingency Reserve',
          labelTR: 'Beklenmeyen Gider Karşılığı',
          value: COST_MULTIPLIERS.contingency * 100,
          unit: '%',
          source: 'default',
          editable: true,
          description: 'Buffer for unexpected costs as % of subtotal',
          descriptionTR: 'Beklenmeyen maliyetler için tampon (ara toplam %)',
          min: 5,
          max: 25,
          step: 1,
        },
      ],
    },

    timeline: {
      groupKey: 'timeline',
      groupLabel: 'Timeline & Inflation',
      groupLabelTR: 'Süre ve Enflasyon',
      parameters: [
        {
          key: 'constructionMonths',
          label: 'Construction Duration',
          labelTR: 'İnşaat Süresi',
          value: timelineDefaults.constructionMonths,
          unit: 'ay',
          source: inputs.constructionMonths ? 'user_input' : 'calculated',
          editable: true,
          description: 'Estimated months to complete construction',
          descriptionTR: 'Tahmini inşaat tamamlanma süresi',
          min: 6,
          max: 36,
          step: 1,
        },
        {
          key: 'startDate',
          label: 'Start Date',
          labelTR: 'Başlangıç Tarihi',
          value: inputs.startDate || new Date().toISOString().split('T')[0],
          unit: '',
          source: inputs.startDate ? 'user_input' : 'calculated',
          editable: true,
          description: 'Project start date',
          descriptionTR: 'Proje başlangıç tarihi',
        },
        {
          key: 'monthlyInflationRate',
          label: 'Monthly Inflation Rate',
          labelTR: 'Aylık Enflasyon Oranı',
          value: timelineDefaults.monthlyInflationRate * 100,
          unit: '%',
          source: inputs.monthlyInflationRate ? 'user_input' : 'default',
          editable: true,
          description: 'Expected monthly cost inflation (2.5% = ~34% annual)',
          descriptionTR: 'Beklenen aylık maliyet enflasyonu (2.5% = ~%34 yıllık)',
          min: 0,
          max: 10,
          step: 0.1,
        },
        {
          key: 'costDistribution',
          label: 'Cost Distribution Model',
          labelTR: 'Maliyet Dağılım Modeli',
          value: timelineDefaults.costDistribution,
          unit: '',
          source: 'default',
          editable: true,
          description: 'How costs are spread: S-curve (realistic) or Linear (simple)',
          descriptionTR: 'Maliyetlerin dağılımı: S-eğrisi (gerçekçi) veya Doğrusal (basit)',
        },
        {
          key: 'monthsToSell',
          label: 'Months to Sell After Completion',
          labelTR: 'Tamamlandıktan Sonra Satış Süresi',
          value: timelineDefaults.monthsToSell,
          unit: 'ay',
          source: inputs.monthsToSellAfterCompletion ? 'user_input' : 'default',
          editable: true,
          description: 'Expected time to sell units after completion',
          descriptionTR: 'Tamamlandıktan sonra beklenen satış süresi',
          min: 0,
          max: 24,
          step: 1,
        },
      ],
    },

    salesMarket: {
      groupKey: 'salesMarket',
      groupLabel: 'Sales & Market',
      groupLabelTR: 'Satış ve Piyasa',
      parameters: [
        {
          key: 'currentSalePricePerSqm',
          label: 'Current Sale Price per sqm',
          labelTR: 'Güncel Satış m² Fiyatı',
          value: salesPricePerSqm,
          unit: 'TL/m²',
          source: 'district_data',
          editable: true,
          description: 'Current average sale price for this project type and quality',
          descriptionTR: 'Bu proje tipi ve kalite için güncel ortalama satış fiyatı',
          min: 10000,
          max: 150000,
          step: 1000,
        },
        {
          key: 'monthlyAppreciationRate',
          label: 'Monthly Price Appreciation',
          labelTR: 'Aylık Fiyat Artışı',
          value: timelineDefaults.monthlyAppreciationRate * 100,
          unit: '%',
          source: inputs.monthlyAppreciationRate ? 'user_input' : 'default',
          editable: true,
          description: 'Expected monthly property price increase (1.5% = ~20% annual)',
          descriptionTR: 'Beklenen aylık emlak fiyat artışı (1.5% = ~%20 yıllık)',
          min: -2,
          max: 5,
          step: 0.1,
        },
        {
          key: 'estimatedUnits',
          label: 'Estimated Number of Units',
          labelTR: 'Tahmini Ünite Sayısı',
          value: Math.floor(inputs.totalSqm / (inputs.projectType === 'apartment' ? 120 : inputs.projectType === 'villa' ? 200 : 140)),
          unit: 'adet',
          source: 'calculated',
          editable: false,
          description: 'Estimated number of saleable units',
          descriptionTR: 'Tahmini satılabilir ünite sayısı',
        },
      ],
    },

    financial: {
      groupKey: 'financial',
      groupLabel: 'Financial Summary',
      groupLabelTR: 'Finansal Özet',
      parameters: [
        {
          key: 'totalLandCost',
          label: 'Total Land Cost',
          labelTR: 'Toplam Arsa Maliyeti',
          value: landPricePerSqm * inputs.landSize,
          unit: 'TL',
          source: 'calculated',
          editable: false,
          description: 'Total cost to acquire land',
          descriptionTR: 'Toplam arsa edinme maliyeti',
        },
        {
          key: 'totalConstructionCost',
          label: 'Total Construction Cost (Nominal)',
          labelTR: 'Toplam İnşaat Maliyeti (Nominal)',
          value: constructionCostPerSqm * inputs.totalSqm,
          unit: 'TL',
          source: 'calculated',
          editable: false,
          description: 'Total construction cost before inflation',
          descriptionTR: 'Enflasyondan önce toplam inşaat maliyeti',
        },
      ],
    },
  }
}
